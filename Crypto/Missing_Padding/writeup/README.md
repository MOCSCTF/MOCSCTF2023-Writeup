## 題目名稱

missing_padding

## 題目類型

Crypto

## 題目說明

Where is my padding?

## WriteUp

It is natural to relate this problem with the Franklin-Reiter attack, but in this problem the message is repeated twice and thus change the polynomials used in the attack. Noting that the length of the flag and padding is 96 and 25 respectively, we can easily change the polynomials to the following form
$$
f = (1 + 2^{8*96})x\\
g = (1+2^{8*(96 + 20)})(2^{8*20}x+y)
$$
Using these polynomials we can compute the small roots up to $2048/9\approx 227$bits. In this case the padding is 200bits which is far below the CopperSmith method's bound. After recover the padding, we can decrypt the message using related message attack.

```python
from Crypto.Util.number import *
N = 28850806092779774979038566429897552758973066495009201283320132130054741352743007818266370255033770790072908022650777788498717561076043778387516689988758865093809797328102262124894239629056593690771388569034103267199343744449335586194347046488310556513224019765166747482786019734618451598528046180031337090126041472308658773301076712975092974324379106961894150821262296445896629234465340414310438761629619971794782765677287317914389264382151966389730665808773829283525972396705761264380869079864222980425340090465445011172405663459075541378166370315081495434380021111994932836146032231246902107500470091612643245515563
c1 = 25810453793052239836346897493098824310737263536448400831041785979338412865548670594665894312110357049282896977026070810693185577358840636095579862699489294718360900512403218976317113997249421491854813477862735146523642977742681302009910706573641632034484286322347635773901359478769491069864464064788763905082430005396085603583475610183908350243108597846742771978829452516143073011019450242888352643410142888233236253563395098192198753704901672776026002206028630945472197673234814045868002425618569633298519878680091841450190483838117178010538283950360383943812297320406393904348577973295610682150432835493398911211303
c2 = 14557100831461823259776226564922058540605943276480554801025835301489298649929016400601137334889154920354160148308928565572923436816744069421097180802523393777282546929761059396818927798183541707369184719983836197479661284429382442195066887731607885890398849700974274857504842694707006517708862405054202947529743532635063312309161813013971979875122949648294202521650299122343487632526065513913522066723568734656137801249526510819944874474377510337180192174950326634516818297071060579263772099306658119453161510840946684127478245484233037193799859694476484859951286855926308346478697960450140896061569685125112565407665


e = 3
PRxy.<x,y> = PolynomialRing(Zmod(N))
PRx.<xn> = PolynomialRing(Zmod(N))
PRZZ.<xz,yz> = PolynomialRing(Zmod(N))
f = 0
g = 0
for i in range(2):
    f += x*(2^(8*96))^i
    g += (x*2^200 + y) * (2 ^ (200 + 8 * 96))^i
f = f ^ e - c1 
g = g ^ e - c2
f1 = f.change_ring(PRZZ)
g1 = g.change_ring(PRZZ)
h = g1.resultant(f1)
h = h.univariate_polynomial()
h = h.change_ring(PRx).subs(y=xn).monic()
roots = h.small_roots(X=2^200,beta=1,epsilon=1/70)
print(roots)
padding = int(roots[0])

P.<x> = PolynomialRing(Zmod(N))
f = 0
g = 0
for i in range(2):
    f += x*(2^(8*96))^i
    g += (x*2^200 + padding) * (2 ^ (200 + 8 * 96))^i
f = P(f ^ e - c1)
g = P(g ^ e - c2)
def GCD(f,g):
    while g:
        f,g = g, f%g
    return f
k = GCD(f,g).monic()
print(long_to_bytes(int(-k[0])))
```

 ## flag

MOCSCTF{You_find_the_missing_padding!_018e3ffec16e2f50b6}